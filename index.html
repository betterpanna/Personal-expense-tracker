<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body { background: #f0f2f5; padding: 20px; font-family: 'Segoe UI', sans-serif; }
    .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
    .budget-progress { height: 25px; border-radius: 12px; overflow: hidden; background: #e9ecef; }
    .quick-btn { border: 1px solid #dee2e6; background: white; padding: 10px; border-radius: 10px; transition: 0.2s; width: 100%; margin-bottom: 8px; text-align: left; }
    .quick-btn:hover { background: #f8f9fa; transform: translateY(-2px); }
    #conv-result { font-weight: bold; color: #0d6efd; font-size: 1.2rem; }
  </style>
</head>
<body>
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
      <div>
        <h2 id="t-title" class="fw-bold text-primary mb-0">Finance Dashboard</h2>
        <div class="d-flex gap-2 mt-2">
          <input type="month" id="month-picker" class="form-control form-control-sm" style="width: 160px;" onchange="refreshData()">
          <div class="input-group input-group-sm" style="width: 140px;">
            <span class="input-group-text">$</span>
            <input type="number" id="budget-goal" class="form-control" placeholder="Limit" onchange="saveNewBudget(this.value)">
          </div>
        </div>
      </div>
      <select id="lang-select" class="form-select w-auto shadow-sm" onchange="applyLanguage(this.value)">
        <option value="en">English</option>
        <option value="jp">æ—¥æœ¬èªž</option>
        <option value="bn">à¦¬à¦¾à¦‚à¦²à¦¾</option>
      </select>
    </div>

    <div class="card p-3">
      <div class="d-flex justify-content-between mb-1">
        <span id="t-budget-label" class="fw-bold small">Monthly Limit</span>
        <span id="budget-percent" class="badge bg-primary">0%</span>
      </div>
      <div class="budget-progress progress"><div id="budget-bar" class="progress-bar bg-success" style="width: 0%"></div></div>
    </div>

    <div class="card p-4">
      <h6 id="t-conv" class="text-muted mb-3">Currency Converter</h6>
      <div class="row g-2 align-items-end">
        <div class="col-md-3"><label id="t-c-amt" class="small">Amount</label><input type="number" id="c-amt" class="form-control" oninput="doConvert()"></div>
        <div class="col-md-3"><label id="t-c-from" class="small">From</label><select id="c-from" class="form-select" onchange="doConvert()"></select></div>
        <div class="col-md-3"><label id="t-c-to" class="small">To</label><select id="c-to" class="form-select" onchange="doConvert()"></select></div>
        <div class="col-md-3 text-center border rounded bg-light p-2" id="conv-result">0.00</div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-4">
        <div class="card p-4">
          <h5 id="t-new">Add Transaction</h5>
          <div class="mb-2"><label id="l-type" class="small">Type</label><select id="type" class="form-select"><option value="Expense" id="opt-exp">Expense</option><option value="Income" id="opt-inc">Income</option></select></div>
          <div class="mb-2"><label id="l-cat" class="small">Category</label><select id="cat" class="form-select"></select></div>
          <div class="mb-2"><label id="l-curr" class="small">Currency</label><select id="curr" class="form-select"></select></div>
          <div class="mb-2"><label id="l-amt" class="small">Amount</label><input type="number" id="amt" class="form-control"></div>
          <button id="b-save" onclick="save()" class="btn btn-primary w-100 mt-2">Save</button>
        </div>
        <div class="card p-3"><h6 id="t-quick" class="text-muted small mb-3">Quick Add</h6><div id="quick-btn-container"></div></div>
      </div>

      <div class="col-lg-8">
        <div class="row text-center mb-3">
          <div class="col-4"><div class="card p-2 text-success border-0"><small id="t-inc-label">Income</small><h5 id="v-inc">$0</h5></div></div>
          <div class="col-4"><div class="card p-2 text-danger border-0"><small id="t-exp-label">Expense</small><h5 id="v-exp">$0</h5></div></div>
          <div class="col-4"><div class="card p-2 text-primary border-0"><small id="t-bal-label">Balance</small><h5 id="v-bal">$0</h5></div></div>
        </div>
        <div class="card p-4"><h5 id="t-chart" class="text-muted small mb-4 text-center">Spending Analysis</h5><div id="piechart" style="height: 350px;"></div></div>
      </div>
    </div>
  </div>

  <script>
    const dictionary = {
      en: { title: "Finance Pro", budget: "Limit: $", conv: "Converter", cAmt: "Amount", cFrom: "From", cTo: "To", new: "Add Transaction", quick: "Quick Add", inc: "Income", exp: "Expense", bal: "Balance", chart: "Monthly Spending Analysis", save: "Save", cats: ["Salary", "Rent", "Food", "Loan", "Shopping", "Household", "Transport"], currs: { USD: "USD ($)", JPY: "JPY (Â¥)", BDT: "BDT (à§³)" }, quickItems: [{cat: "Food", amt: 10, curr: "USD", label: "ðŸ” Food ($10)"}, {cat: "Transport", amt: 500, curr: "JPY", label: "ðŸš† Train (Â¥500)"}] },
      jp: { title: "è²¡å‹™ãƒ—ãƒ­", budget: "äºˆç®—: $", conv: "é€šè²¨å¤‰æ›", cAmt: "é‡‘é¡", cFrom: "å¤‰æ›å…ƒ", cTo: "å¤‰æ›å…ˆ", new: "æ–°è¦å…¥åŠ›", quick: "ã‚¯ã‚¤ãƒƒã‚¯è¿½åŠ ", inc: "åŽå…¥", exp: "æ”¯å‡º", bal: "æ®‹é«˜", chart: "æœˆé–“æ”¯å‡ºåˆ†æž", save: "ä¿å­˜", cats: ["çµ¦ä¸Ž", "å®¶è³ƒ", "é£Ÿè²»", "ãƒ­ãƒ¼ãƒ³", "è²·ã„ç‰©", "å®¶äº‹", "äº¤é€šè²»"], currs: { USD: "ç±³ãƒ‰ãƒ« ($)", JPY: "æ—¥æœ¬å†† (Â¥)", BDT: "ã‚¿ã‚« (à§³)" }, quickItems: [{cat: "Food", amt: 10, curr: "USD", label: "ðŸ” é£Ÿè²» ($10)"}, {cat: "Transport", amt: 500, curr: "JPY", label: "ðŸš† é›»è»Š (Â¥500)"}] },
      bn: { title: "à¦«à¦¾à¦‡à¦¨à§à¦¯à¦¾à¦¨à§à¦¸ à¦ªà§à¦°à§‹", budget: "à¦¬à¦¾à¦œà§‡à¦Ÿ: $", conv: "à¦•à¦¾à¦°à§‡à¦¨à§à¦¸à¦¿ à¦•à¦¨à¦­à¦¾à¦°à§à¦Ÿà¦¾à¦°", cAmt: "à¦ªà¦°à¦¿à¦®à¦¾à¦£", cFrom: "à¦¥à§‡à¦•à§‡", cTo: "à¦ªà¦°à§à¦¯à¦¨à§à¦¤", new: "à¦¨à¦¤à§à¦¨ à¦à¦¨à§à¦Ÿà§à¦°à¦¿", quick: "à¦¦à§à¦°à§à¦¤ à¦¯à§‹à¦— à¦•à¦°à§à¦¨", inc: "à¦†à¦¯à¦¼", exp: "à¦¬à§à¦¯à¦¯à¦¼", bal: "à¦¬à§à¦¯à¦¾à¦²à§‡à¦¨à§à¦¸", chart: "à¦®à¦¾à¦¸à¦¿à¦• à¦¬à§à¦¯à¦¯à¦¼ à¦¬à¦¿à¦¶à§à¦²à§‡à¦·à¦£", save: "à¦¸à¦‚à¦°à¦•à§à¦·à¦£", cats: ["à¦¬à§‡à¦¤à¦¨", "à¦­à¦¾à¦¡à¦¼à¦¾", "à¦–à¦¾à¦¬à¦¾à¦°", "à¦‹à¦£", "à¦•à§‡à¦¨à¦¾à¦•à¦¾à¦Ÿà¦¾", "à¦—à§ƒà¦¹à¦¸à§à¦¥à¦¾à¦²à§€", "à¦ªà¦°à¦¿à¦¬à¦¹à¦¨"], currs: { USD: "à¦‡à¦‰à¦à¦¸ à¦¡à¦²à¦¾à¦° ($)", JPY: "à¦‡à¦¯à¦¼à§‡à¦¨ (Â¥)", BDT: "à¦Ÿà¦¾à¦•à¦¾ (à§³)" }, quickItems: [{cat: "Food", amt: 10, curr: "USD", label: "ðŸ” à¦–à¦¾à¦¬à¦¾à¦° ($à§§à§¦)"}, {cat: "Transport", amt: 500, curr: "JPY", label: "ðŸš† à¦Ÿà§à¦°à§‡à¦¨ (Â¥à§«à§¦à§¦)"}] }
    };

    let exchangeRates = {};
    window.onload = () => {
      document.getElementById('month-picker').value = new Date().toISOString().slice(0, 7);
      applyLanguage('en');
    };

    function applyLanguage(l) {
      const d = dictionary[l];
      document.getElementById('t-title').innerText = d.title;
      document.getElementById('t-conv').innerText = d.conv;
      document.getElementById('t-c-amt').innerText = d.cAmt;
      document.getElementById('t-c-from').innerText = d.cFrom;
      document.getElementById('t-c-to').innerText = d.cTo;
      document.getElementById('t-new').innerText = d.new;
      document.getElementById('t-quick').innerText = d.quick;
      document.getElementById('t-inc-label').innerText = d.inc;
      document.getElementById('t-exp-label').innerText = d.exp;
      document.getElementById('t-bal-label').innerText = d.bal;
      document.getElementById('t-chart').innerText = d.chart;
      document.getElementById('b-save').innerText = d.save;
      document.getElementById('opt-exp').innerText = d.exp;
      document.getElementById('opt-inc').innerText = d.inc;

      ['curr', 'c-from', 'c-to'].forEach(id => {
        const s = document.getElementById(id); const v = s.value;
        s.innerHTML = `<option value="USD">${d.currs.USD}</option><option value="JPY">${d.currs.JPY}</option><option value="BDT">${d.currs.BDT}</option>`;
        if(v) s.value = v;
      });

      const catSelect = document.getElementById('cat');
      catSelect.innerHTML = ""; d.cats.forEach(c => catSelect.innerHTML += `<option value="${c}">${c}</option>`);

      const qContainer = document.getElementById('quick-btn-container');
      qContainer.innerHTML = "";
      d.quickItems.forEach(item => {
        qContainer.innerHTML += `<button class="quick-btn" onclick="quickAdd('${item.cat}', ${item.amt}, '${item.curr}')">${item.label}</button>`;
      });

      refreshData();
    }

    function doConvert() {
      const a = document.getElementById('c-amt').value;
      const f = document.getElementById('c-from').value;
      const t = document.getElementById('c-to').value;
      if (!a || !exchangeRates.JPY) return;
      let usd = f === 'USD' ? a : a / exchangeRates[f];
      document.getElementById('conv-result').innerText = (t === 'USD' ? usd : usd * exchangeRates[t]).toFixed(2);
    }

    function saveNewBudget(val) {
      if(!val) return;
      google.script.run.withSuccessHandler(() => { refreshData(); }).updateBudget(val);
    }

    function refreshData() {
      const m = document.getElementById('month-picker').value;
      const l = document.getElementById('lang-select').value;
      google.script.run.withSuccessHandler(res => {
        exchangeRates = res.rates;
        document.getElementById('budget-goal').value = res.budgetLimit;
        document.getElementById('v-inc').innerText = "$" + res.stats.inc;
        document.getElementById('v-exp').innerText = "$" + res.stats.exp;
        document.getElementById('v-bal').innerText = "$" + res.stats.bal;
        
        const limit = res.budgetLimit || 1000;
        const p = Math.min((res.stats.exp / limit) * 100, 100);
        document.getElementById('t-budget-label').innerText = dictionary[l].budget + limit;
        
        const b = document.getElementById('budget-bar');
        b.style.width = p + "%"; b.className = p > 80 ? "progress-bar bg-danger" : "progress-bar bg-success";
        document.getElementById('budget-percent').innerText = Math.round(p) + "%";

        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(() => {
          if (res.chart.length > 1) {
            new google.visualization.PieChart(document.getElementById('piechart')).draw(google.visualization.arrayToDataTable(res.chart), { 
              pieHole: 0.4, chartArea:{width:'100%',height:'80%'}, legend: 'bottom' 
            });
          }
        });
        doConvert();
      }).getDashboardData(m, l);
    }

    function save() {
      const d = { type: document.getElementById('type').value, category: document.getElementById('cat').value, curr: document.getElementById('curr').value, amount: document.getElementById('amt').value };
      google.script.run.withSuccessHandler(() => { alert("Saved!"); refreshData(); }).saveTransaction(d);
    }

    function quickAdd(cat, amt, curr) {
      google.script.run.withSuccessHandler(() => { refreshData(); }).saveTransaction({ type: 'Expense', category: cat, curr: curr, amount: amt });
    }
  </script>
</body>
</html>
